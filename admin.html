<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Administración</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="mb-4">Panel de Administración</h2>
    <div id="usuarios-container" class="table-responsive"></div>
  </div>

  <script>
    const supabase = supabase.createClient(
      'https://brzsayjqohyhpssfgqct.supabase.co',
      'Markitho15' //TU-CLAVE-SECRETA-CON-ROL-ADMIN
    );

    async function cargarUsuarios() {
      const { data: usuarios, error } = await supabase.from('usuarios').select('*');
      if (error) {
        return alert('Error al cargar usuarios');
      }

      const tabla = `
        <table class="table table-bordered table-hover">
          <thead class="table-dark">
            <tr>
              <th>Usuario</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            ${usuarios.map(u => `
              <tr>
                <td>${u.nombre}</td>
                <td>${u.email}</td>
                <td>${u.rol || 'No asignado'}</td>
                <td>${u.activo ? '<span class="badge bg-success">Aprobado</span>' : '<span class="badge bg-warning text-dark">Pendiente</span>'}</td>
                <td>
                  ${!u.activo ? `
                    <button class="btn btn-sm btn-success me-1" onclick="aprobar('${u.id}')">Aprobar</button>
                    <button class="btn btn-sm btn-danger" onclick="rechazar('${u.id}')">Rechazar</button>
                  ` : `
                    <button class="btn btn-sm btn-secondary" disabled>Aprobado</button>
                  `}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      document.getElementById('usuarios-container').innerHTML = tabla;
    }

    async function aprobar(id) {
      const { error } = await supabase.from('usuarios').update({ activo: true }).eq('id', id);
      if (error) return alert('Error al aprobar usuario');
      cargarUsuarios();
    }

    async function rechazar(id) {
      const { error } = await supabase.from('usuarios').delete().eq('id', id);
      if (error) return alert('Error al eliminar usuario');
      cargarUsuarios();
    }

    cargarUsuarios();
  </script>
</body>
</html>
