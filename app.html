<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Bienvenido a la App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body class="bg-light">

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Mi App</a>
      <div class="d-flex">
        <span id="userEmail" class="text-white me-3"></span>
        <button class="btn btn-outline-light btn-sm" onclick="logout()">Cerrar sesión</button>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <div class="alert alert-info" id="bienvenida" style="display: none;"></div>
    <h3>Tu panel</h3>
    <p id="creditos" class="fw-bold">Cargando créditos...</p>
    <!-- Aquí puedes insertar tus botones o módulos principales -->
  </div>

  <script>
    const supabase = supabase.createClient(
      'https://brzsayjqohyhpssfgqct.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' // tu clave pública
    );

    verificarSesion();

    async function verificarSesion() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        return (window.location.href = 'login.html');
      }

      // Validar si el usuario está aprobado manualmente
      const { data: usuario, error } = await supabase
        .from('usuarios')
        .select('activo, creditos')
        .eq('id', user.id)
        .single();

      if (error || !usuario || !usuario.activo) {
        alert('Tu cuenta no tiene acceso o no ha sido aprobada.');
        await supabase.auth.signOut();
        return (window.location.href = 'login.html');
      }

      document.getElementById('userEmail').innerText = user.email;
      document.getElementById('bienvenida').innerText = `¡Hola ${user.email}, bienvenido a tu panel!`;
      document.getElementById('bienvenida').style.display = 'block';
      document.getElementById('creditos').innerText = `Créditos disponibles: ${usuario.creditos}`;
    }

    async function logout() {
      await supabase.auth.signOut();
      window.location.href = 'login.html';
    }
  </script>
</body>
</html>
